name: GHA Codebuild Runner Test

on:
  pull_request:
    branches: [main]

jobs:
  test1:
    env:
      CLOUDWATCH_LOGGROUP_NAME: '/aws/codebuild/cfpb-regtech-gha-test-1'
      CLOUDWATCH_LOGSTREAM_NAME: ${{ github.run_id }}${{ github.run_number }}${{ github.run_attempt }}
    runs-on:
      - codebuild-cfpb-regtech-gha-test-1-${{ github.run_id }}-${{ github.run_attempt }}
    steps:
      - name: 'Checkout GitHub Action'
        uses: actions/checkout@v4

      - name: echo
        run: |
          echo "force trigger again"
          echo -e "running GHA workflow ${{ github.event.number }}\nbuild: ${{ github.run_id }}\nattempt: ${{ github.run_attempt }}"

      - name: create log stream
        run: |
          aws logs create-log-stream --log-group-name $CLOUDWATCH_LOGGROUP_NAME --log-stream-name $CLOUDWATCH_LOGSTREAM_NAME

      - name: list buckets
        run: |
          aws s3api list-buckets --region us-east-1 --output json

      - name: put events
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          ls -alt >events_test
          aws logs put-log-events --log-group-name $CLOUDWATCH_LOGGROUP_NAME --log-stream-name $CLOUDWATCH_LOGSTREAM_NAME --log-events file://events_test

